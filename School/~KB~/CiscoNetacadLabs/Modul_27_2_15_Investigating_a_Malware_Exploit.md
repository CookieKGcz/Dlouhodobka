# Part 1: Use Kibana to Learn About a Malware Exploit
## Step 2: Locate the Event in Kibana
e)
Look at the expanded alert details and answer the following questions:
What is the time of the first detected NIDS alert in Kibana?
- ![[Pasted image 20250404093734.png]]

What is the source IP address in the alert?
- ![[Pasted image 20250404093751.png]]

What is the destination IP address in the alert? 
- ![[Pasted image 20250404093810.png]]

What is the destination port in the alert? What service is this? 
- ![[Pasted image 20250404093821.png]]

What is the classification of the alert? 
- ![[Pasted image 20250404093839.png]]

What is the destination geo country name?
- ![[Pasted image 20250404093857.png]]

f)
![[Pasted image 20250404094033.png]]
nejde zobrazit
![[Pasted image 20250404094636.png]]
What is the malware family for this event?
- ?

What is the severity of the exploit?
- ?

What is an Exploit Kit? (EK) Search on the internet to answer this question.
- nástroj používaný pro automatickou správu a nasazení exploitů proti cílovému počítači. Exploit kity umožňují útočníkům doručovat malware, aniž by měli pokročilé znalosti o používaných exploitech.

## Step 3: View the Transcript capME!
What website did the user intend to connect to? 
- ![[Pasted image 20250404094854.png]]

What URL did the browser refer the user to? 
- ![[Pasted image 20250404094923.png]]

What kind of content is requested by the source host from tybenme.com? Why could this be a problem? Look in the DST server block of the transcript too.
- ![[Pasted image 20250404095001.png]]
- Pravděpodobně to je rozkouskovaný malware gzipem, aby obešel upozornění/odchycení

e)
What are some of the websites that are listed?
- ![[Pasted image 20250404095657.png]]

Which of these sites is likely part of the exploit campaign?
- tyu.benme.com, homeimprovement, p27...top, a retro.tip jsou velice podezřelé![[Pasted image 20250404095555.png]]

What are the HTTP - MIME Types listed in the Tag Cloud?
- ![[Pasted image 20250404095859.png]]


# Part 2: Investigate the Exploit with Sguil
## Step 1: Open Sguil and locate the alerts.
b)
According to Sguil, what are the timestamps for the first and last of the alerts that occurred within about a second of each other?
- ![[Pasted image 20250404100101.png]]
- 54:42 až 55:28

## Step 2: Investigate the alerts in Sguil
b)
According to the IDS signature rule which malware family triggered this alert? You may need to scroll through the alert signature to find this entry.
- ![[Pasted image 20250404100256.png]]

c)
According to the Event Messages in Sguil what exploit kit (EK) is involved in this attack?
- RIG EK Exploit

Beyond labelling the attack as trojan activity, what other information is provided regarding the type and name of the malware involved?
- ![[Pasted image 20250404100546.png]]

By your best estimate looking at the alerts so far, what is the basic vector of this attack? How did the attack take place?
- Jelikož se první připojujeme na port 80, podle mě jde o vstupení na špatnou stránku

## Step 3: View Transcripts of Events
a)
What are the referer and host websites that are involved in the first SRC event? What do you think the user did to generate this alert?
- ![[Pasted image 20250404100859.png]]
- User pravděpodobně hledal normální house improvement a našel malware stránku.

c)
What kind of request was involved?
- HTTP/. GET request

Were any files requested?
- dle_js.js

What is the URL for the referer and the host website?
- referer homeimprovement a host retrotip..

How the content encoded?
- gzip

d)
How many requests and responses were involved in this alert? 
- GET POST GET a 3 odpovědi

What was the first request? 
- ![[Pasted image 20250404161357.png]]

Who was the referrer? 
- ![[Pasted image 20250404161651.png]]

Who was the host server request to? 
- ![[Pasted image 20250404161718.png]]

Was the response encoded? 
- ano gzip

What was the second request? 
- ![[Pasted image 20250404161749.png]]

Who was the host server request to? 
- ![[Pasted image 20250404161718.png]]

Was the response encoded? 
- ano gzip

What was the third request? 
- ![[Pasted image 20250404162049.png]]

Who was the referrer?
- ![[Pasted image 20250404162006.png]]

What was the Content-Type of the third response? 
- ![[Pasted image 20250404162111.png]]

What were the first 3 characters of the data in the response?
- CWS

What type of file was downloaded? What application uses this type of file?
- ![[Pasted image 20250404162310.png]]swf, Adobe Flash

How many files are there and what is the file types?
- ![[Pasted image 20250404162408.png]]

# Part 3: Use Wireshark to Investigate an Attack
## Step 2: Investigate HTTP Traffic
b)
What website directed the user to the www.homeimprovement.com website?
- ![[Pasted image 20250404162819.png]]
- bing
## Step 3: View HTTP Objects.
c)
What is the http request for?
- ![[Pasted image 20250404163050.png]]
- dle_js.js
Host server?
- retrotip...

## Step 4: Create a Hash for an Exported Malware File.
![[Pasted image 20250404163822.png]]
![[Pasted image 20250404163908.png]]
![[Pasted image 20250404164605.png]]
What did VirusTotal tell you about this file?
- že to je malware (trojský kůň) ![[Pasted image 20250404164713.png]]

g)
Are there any similarities to the earlier alerts?
- Stejný postup s GET POST GET![[Pasted image 20250404164906.png]]

Are the files similar? Do you see any differences?
- ![[Pasted image 20250404164942.png]]
- znova máme 2x text a flash file, co se změnilo jsou jména souborů

h)
Is this the same malware that was downloaded in the previous HTTP session?
- Ano, oba hashe jsou stejné

i)
Why do they seem to be post-infection?
- Všechny alerty už alertujou specificky na malware
- ![[Pasted image 20250404165619.png]]

What is interesting about first alert in the last 4 alerts in the series?
- ![[Pasted image 20250404165704.png]]Destination adresa je 90.2.1.0 (nějaký útočníkův server/stroj pravděpodobně)

What type of communication is taking place in the second and third alerts in the series and what makes it suspicious?
- ![[Pasted image 20250404165822.png]] 
- Používají port 53, takže se snaží komunikovat přes DNS zprávy
- I alert upozorňuje na .top doménu, že je podezřelá
- ![[Pasted image 20250404165937.png]]

j)
What is the result?
![[Pasted image 20250404170530.png]]

k)
What are the filenames if any?
- ![[Pasted image 20250404170628.png]]
- html soubor

# Part 4: Examine Exploit Artifacts
a)
Can you find the two places in the webpage that are part of the drive-by attack that started the exploit?
- ![[Pasted image 20250404170928.png]]

b)
What does the file do?
- Vytvoří iframe (writne do hlavičky přesměrování na tyu.benme.com)

How does the code in the javascript file attempt to avoid detection?
- ![[Pasted image 20250404171216.png]]

c)
What kind of file it is?
- HTML stránka

What are some interesting things about the iframe? Does it call anything?
![[Pasted image 20250404171451.png]]
- volá start() funkci

What does the start() function do?
- ![[Pasted image 20250404171527.png]]
- uloží si browser, porovná ho,  vytvoří inner body POST form kde submitne NormalURL. 
- ![[Pasted image 20250404171750.png]]
- Přičemž NormalURL je URL tyu.benme.com

What do you think the purpose of the getBrowser() function is?
- Jaký má uživatel browser

# Reflection
The EK used a number of websites. Complete the table below.
mělo by být i postupně

| URL                         | IP address     | Function                                  |
| --------------------------- | -------------- | ----------------------------------------- |
| www.bing.com                | N/A            | search engine links to legitimate webpage |
| www.homeimprovement.com     | 104.28.18.74   | redirect                                  |
| retrotip.visionurbana.ve    | 139.59.160.143 | js script v iframu?                       |
| tyu.benme.com               | 194.87.234.129 | stáhnutí adobe fileu                      |
| p27dokhpz2n7nvgr.1jw2lx.top | 198.105.121.50 | ransomware stránka                        |
|                             |                |                                           |
+ + IP adresa 90.2.1.0 (možná CnC server)
It is useful to “tell the story” of an exploit to understand what happened and how it works. Start with the user searching the internet with Bing. Search the web for more information on the RIG EK to help.
- User hledal legitimní stránky na vylepšení domu
- Klikl na stránku která ho redirectla
- Stáhl se adobe file a ten spustil stáhnutí malwaru
- Malware pak kontaktoval IP adresu 90.2.1.0